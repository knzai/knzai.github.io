<!DOCTYPE html>
<html lang="en">
    <head>
      <title>Kenzi Connor: Using Ruby&#x27;s #.extend on instances to avoid modifying a base class</title>
<meta name="description" content="Making a Scrabble word-finder by adding subtraction and overloading the subset operator on #.tally supplied frequency hashes">

<!-- Open Graph Tiles -->
<meta property="og:title" content="Kenzi Connor: Using Ruby&#x27;s #.extend on instances to avoid modifying a base class">
<meta property="og:description" content="Making a Scrabble word-finder by adding subtraction and overloading the subset operator on #.tally supplied frequency hashes">
<meta property="og:image" content="https://knz.ai/assets/images/me.jpg" />
<meta name="twitter:title" content="Kenzi Connor: Using Ruby&#x27;s #.extend on instances to avoid modifying a base class">
<meta name="twitter:description" content="Making a Scrabble word-finder by adding subtraction and overloading the subset operator on #.tally supplied frequency hashes">
<meta name="twitter:image" content="https://knz.ai/assets/images/me.jpg">

<!-- Open Graph Tiles; static -->
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@knzconnor" />
<meta name="twitter:creator" content="@knzconnor" />
<meta property="twitter:domain" content="knz.ai">

<!-- General meta -->
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<!-- Enable responsiveness on mobile devices-->
<!-- viewport-fit=cover is to support iPhone X rounded corners and notch in landscape-->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">
      
  <link rel="icon" href="/assets/images/walle-female.svg">

<!-- CSS -->
<link rel="stylesheet" href="https://knz.ai/print.css" media="print">
<link rel="stylesheet" href="https://knz.ai/poole.css">
<link rel="stylesheet" href="https://knz.ai/hyde.css">
<link rel="stylesheet" href="https://knz.ai/styles.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
      <link rel="alternate" type="application/atom+xml" title="Kenzi Connor Atom Feed" href="https://knz.ai/atom.xml" />
      <link rel="alternate" type="application/rss+xml" title="Kenzi Connor RSS Feed" href="https://knz.ai/rss.xml" />
    </head>
    <body class="theme-base-08 layout-reverse">
      <div class="sidebar">
        
          <div class="container sidebar-sticky">
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item active">posts</li><li class="sidebar-nav-item">
      <a href="https:&#x2F;&#x2F;knz.ai&#x2F;projects&#x2F;" class=>projects</a></li><li class="sidebar-nav-item">
      <a href="https:&#x2F;&#x2F;knz.ai&#x2F;about&#x2F;" class=>about</a></li>
  <li class="sidebar-nav-item">
      <a href="https:&#x2F;&#x2F;knz.ai&#x2F;resume&#x2F;" class=>resume</a></li>

</ul>
  <div class="sidebar-about">
    
        <a href="https:&#x2F;&#x2F;knz.ai"><h1>Kenzi Connor</h1></a>
        
        <p class="lead">Staff Software Engineer - VP Engineering - Director of Engineering - CEO &amp; CTO</p>
        
    
  </div>
  <ul class="sidebar-nav">
      
      <li class="sidebar-nav-item"><a rel="me" href="https:&#x2F;&#x2F;github.com&#x2F;knzai">GitHub</a></li>
      
      <li class="sidebar-nav-item"><a rel="me" href="https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;knzai&#x2F;">LinkedIn</a></li>
      
      <li class="sidebar-nav-item"><a rel="me" href="mailto:site@knz.ai">site@knz.ai</a></li>
      
      <li class="sidebar-nav-item"><a rel="me" href="https:&#x2F;&#x2F;tech.lgbt&#x2F;@knzai">Mastadon</a></li>
      
  </ul>
</div>
        
      </div>
      <div class="content container">
        
	
<div class="breadcrumb-container">
    
    
      
      
        <a class="breadcrumb-path" href="https:&#x2F;&#x2F;knz.ai&#x2F;">knz.ai</a>
      
      <span class="breadcrumb-separator">></span>
    
      
      
        <a class="breadcrumb-path" href="https:&#x2F;&#x2F;knz.ai&#x2F;posts&#x2F;">posts</a>
      
      <span class="breadcrumb-separator">></span>
    
    
    
      ruby-frequency-hash
    
</div>


	<div class="post ruby-frequency-hash">
  
  
  <h2 class="post-title">
    <a href="https:&#x2F;&#x2F;knz.ai&#x2F;posts&#x2F;ruby-frequency-hash&#x2F;" id="Using Ruby's #.extend on instances to avoid modifying a base class">Using Ruby's #.extend on instances to avoid modifying a base class</a>: <span class="post-description">Making a Scrabble word-finder by adding subtraction and overloading the subset operator on #.tally supplied frequency hashes</span>
  </h2>

  <span class="post-date">2024-07-29</span>
  
    <p>I choked a bit on a tech screen today (at least by my own standards), by rushing to a solution too quickly, instead of working out a proper tested class. So after dinner I thought I'd revisit it and see what a cleaner solution might look like.</p>
<p>Problem: Given a supplied scrabble dictionary (text file of words per line - in the test I swap in a small array for speed) write a method that gives all possible words for any hand/set of tiles.</p>
<pre data-lang="ruby" style="background-color:#2b303b;color:#c0c5ce;" class="language-ruby "><code class="language-ruby" data-lang="ruby"><span>@</span><span style="color:#bf616a;">dict </span><span>= </span><span style="color:#ebcb8b;">Scrabble</span><span>::</span><span style="color:#ebcb8b;">Dictionary</span><span>.</span><span style="color:#8fa1b3;">new </span><span>[&quot;</span><span style="color:#a3be8c;">AA</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">AD</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">ADD</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">DAD</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">BAD</span><span>&quot;]
</span><span>assert_equal [&quot;</span><span style="color:#a3be8c;">AD</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">ADD</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">DAD</span><span>&quot;], @</span><span style="color:#bf616a;">dict</span><span>.possible_words(&quot;</span><span style="color:#a3be8c;">ADD</span><span>&quot;)
</span></code></pre>
<span id="continue-reading"></span>
<p>I got most of the way there off right off the bat by just taking the <a href="https://ruby-doc.org/3.2.2/Enumerable.html#method-i-tally">#tally</a> of the the characters of the dictionary and the selected hand. Always learn as much of your language's stdlib/builtins as you can. It's endlessly helpful and saves you a lot of effort re-inventing the wheel. It was very nice to be able to skip half the work by just tacking on a method here or there.</p>
<pre data-lang="ruby" style="background-color:#2b303b;color:#c0c5ce;" class="language-ruby "><code class="language-ruby" data-lang="ruby"><span>&quot;</span><span style="color:#a3be8c;">foobar</span><span>&quot;.chars.tally
</span><span>=&gt; {&quot;</span><span style="color:#a3be8c;">f</span><span>&quot;=&gt;</span><span style="color:#d08770;">1</span><span>, &quot;</span><span style="color:#a3be8c;">o</span><span>&quot;=&gt;</span><span style="color:#d08770;">2</span><span>, &quot;</span><span style="color:#a3be8c;">b</span><span>&quot;=&gt;</span><span style="color:#d08770;">1</span><span>, &quot;</span><span style="color:#a3be8c;">a</span><span>&quot;=&gt;</span><span style="color:#d08770;">1</span><span>, &quot;</span><span style="color:#a3be8c;">r</span><span>&quot;=&gt;</span><span style="color:#d08770;">1</span><span>}
</span></code></pre>
<p>From there the exact #select criteria against the dictionary of words got into some longer method-chaining that wasn't so easy to debug.  Upon later reconsideration, just extending the returned hash with a few methods makes for an easier testing interface. And by extending the hashes directly you don't have to bother with a wrapping class, delegation, or including the methods into Hash and messing with every other hash in your project. If you do this upon intake of the dictionary, it's even a one time performance hit.</p>
<p>So the logic is I need to come up with a subset that is only true if the rhs has not only the keys, or the exact keys and values, but greater or equal values at all keys for a given word. This seemed logically cleanest to me as two operations, a new subtraction operator that subtracts the values of hashes at corresponding keys and then if that returns an empty hash, it's a match. Well, if by "subtracts the values" we mean "and deletes if the rhs has more of an individual tile than needed" but that's fine for our usage, even if it's not how I'd normally implement subtraction. I guess it's "whole numbers only" subtraction, since a negative frequency count, in this usage, doesn't make sense.</p>
<p>You could also do something clever like #transform_value the rhs by negative 1, zipping them togethe, taking the sum, of each, then selecting the value &lt;= 0 entries, but that gets a little complicated, and is a lot of passes compared to just iterating the list and doing the subtraction and delete if, imo.</p>
<p>Later I realized you could also just roll both parts cleanly into a #delete_if and following #empty? check, but this is good enough.</p>
<pre data-lang="ruby" style="background-color:#2b303b;color:#c0c5ce;" class="language-ruby "><code class="language-ruby" data-lang="ruby"><span style="color:#65737e;">#tests for the subtraction that the subset relies on
</span><span style="color:#96b5b4;">hash </span><span>= { </span><span style="color:#a3be8c;">foo: </span><span style="color:#d08770;">5</span><span>, </span><span style="color:#a3be8c;">bar: </span><span style="color:#d08770;">3</span><span>}.</span><span style="color:#8fa1b3;">extend</span><span>(</span><span style="color:#ebcb8b;">Scrabble</span><span>::FreqHash)
</span><span>assert_equal ({</span><span style="color:#a3be8c;">foo: </span><span style="color:#d08770;">2</span><span>}), (</span><span style="color:#96b5b4;">hash </span><span>- {</span><span style="color:#a3be8c;">foo: </span><span style="color:#d08770;">3</span><span>, </span><span style="color:#a3be8c;">bar: </span><span style="color:#d08770;">3</span><span>, </span><span style="color:#a3be8c;">baz: </span><span style="color:#d08770;">3</span><span>})
</span><span>assert_equal ({ </span><span style="color:#a3be8c;">foo: </span><span style="color:#d08770;">5</span><span>, </span><span style="color:#a3be8c;">bar: </span><span style="color:#d08770;">3</span><span>}), </span><span style="color:#96b5b4;">hash </span><span style="color:#65737e;">#make sure you didn&#39;t mutate the actual dict
</span><span>
</span><span style="color:#b48ead;">module </span><span>Scrabble
</span><span>  </span><span style="color:#b48ead;">module </span><span>FreqHash
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#8fa1b3;">extended</span><span>(</span><span style="color:#bf616a;">mod</span><span>)
</span><span>    	</span><span style="color:#65737e;">#avoids the need for constant nil checks
</span><span>      mod.default = </span><span style="color:#d08770;">0
</span><span>    </span><span style="color:#b48ead;">end
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">&lt;=</span><span>(</span><span style="color:#bf616a;">rhs</span><span>)
</span><span>      (</span><span style="color:#bf616a;">self </span><span>- rhs).empty?
</span><span>    </span><span style="color:#b48ead;">end
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">-</span><span>(</span><span style="color:#bf616a;">rhs</span><span>)
</span><span>      newh = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">clone
</span><span>      rhs.each </span><span style="color:#b48ead;">do </span><span>|</span><span style="color:#bf616a;">k</span><span>, </span><span style="color:#bf616a;">v</span><span>|
</span><span>        newh.delete(k) </span><span style="color:#b48ead;">if </span><span>(newh[k] -= v) &lt;= </span><span style="color:#d08770;">0
</span><span>      </span><span style="color:#b48ead;">end
</span><span>      newh
</span><span>    </span><span style="color:#b48ead;">end
</span><span>
</span><span>
</span><span>  </span><span style="color:#b48ead;">end
</span><span>
</span><span>  </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Dictionary </span><span style="color:#eff1f5;">&lt; </span><span style="color:#a3be8c;">Hash
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#8fa1b3;">from_file</span><span>(</span><span style="color:#bf616a;">file_path</span><span>)
</span><span>      </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#8fa1b3;">new</span><span>(</span><span style="color:#ebcb8b;">File</span><span>.</span><span style="color:#96b5b4;">open</span><span>(file_path).</span><span style="color:#96b5b4;">readlines</span><span>.map(&amp;</span><span style="color:#a3be8c;">:strip</span><span>))
</span><span>    </span><span style="color:#b48ead;">end
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">initialize</span><span>(</span><span style="color:#bf616a;">lines</span><span>)
</span><span>      lines.each </span><span style="color:#b48ead;">do </span><span>|</span><span style="color:#bf616a;">line</span><span>|
</span><span>        </span><span style="color:#bf616a;">self</span><span>[line] = line.chars.tally.</span><span style="color:#8fa1b3;">extend</span><span>(</span><span style="color:#bf616a;">FreqHash</span><span>)
</span><span>      </span><span style="color:#b48ead;">end
</span><span>    </span><span style="color:#b48ead;">end
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">possible_words</span><span>(</span><span style="color:#bf616a;">hand</span><span>)
</span><span>      </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">select </span><span>{ |</span><span style="color:#bf616a;">k</span><span>, </span><span style="color:#bf616a;">v</span><span>| v &lt;= hand.chars.tally }.keys
</span><span>    </span><span style="color:#b48ead;">end
</span><span>  </span><span style="color:#b48ead;">end
</span><span style="color:#b48ead;">end
</span></code></pre>

  
</div>

      </div>
    </body>
</html>
